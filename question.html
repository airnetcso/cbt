<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soal Ujian Korea</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { background: white; padding: 15px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; font-size: 22px; font-weight: bold; color: #2c3e50; }
        .content { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 20px; }
        @media (min-width: 768px) { .content { flex-direction: row; } }
        .options-column { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .question-column { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); flex: 1; }
        .question-text { font-size: 1.5em; line-height: 1.8; }
        .question-img { max-width: 100%; height: auto; margin-top: 20px; border-radius: 8px; }
        .audio-control { text-align: center; margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 10px; }
        audio { width: 100%; max-width: 400px; }
        .replay-btn { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        .replay-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        .replay-count { display: block; margin-top: 10px; font-weight: bold; color: #e74c3c; }
        .options label { display: block; padding: 18px; margin: 10px 0; background: #ecf0f1; border-radius: 10px; cursor: pointer; font-size: 18px; transition: all 0.3s; }
        .options label:hover { background: #d5dbdb; }
        .bottom-nav { background: white; padding: 15px; box-shadow: 0 -4px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
        .nav-btn { padding: 14px 20px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; flex: 1; min-width: 100px; }
        .prev-btn { background: #3498db; color: white; }
        .back-btn { background: #e91e63; color: white; }
        .next-btn { background: #2ecc71; color: white; }
        .nav-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="top-bar" id="questionTitle">Soal ...</div>
    <div class="content">
        <div class="options-column">
            <div class="options" id="options"></div>
        </div>
        <div class="question-column">
            <div class="question-text" id="questionText">Memuat soal...</div>
            <img id="questionImg" class="question-img" style="display:none;" alt="Gambar soal">
            <div class="audio-control" id="audioControl" style="display:none;">
                <audio id="audioPlayer" controls></audio>
                <button class="replay-btn" id="replayBtn" onclick="replayAudio()">Replay dari Awal</button>
                <span class="replay-count" id="replayCount">Sisa kesempatan dengar: 2</span>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn prev-btn" id="prevBtn" onclick="goPrev()">◄ Sebelumnya</button>
        <button class="nav-btn back-btn" onclick="goBack()">Kembali ke Navigasi</button>
        <button class="nav-btn next-btn" id="nextBtn" onclick="goNext()">Berikutnya ►</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let currentQ = parseInt(urlParams.get('q')) || 0;
        let answers = JSON.parse(localStorage.getItem('answers')) || new Array(40).fill(null);
        let playCount = 0; // Total play/replay, max 2

        const questions = [ /* Array questions sama seperti versi sebelumnya, dengan audio & image */ ];

        function loadQuestion() {
            const q = questions[currentQ];
            document.getElementById('questionTitle').textContent = `Soal ${currentQ + 1} - ${currentQ < 20 ? 'Listening' : 'Reading'}`;
            document.getElementById('questionText').innerHTML = q.question;

            // Options
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = q.options.map((opt, idx) => `
                <label>
                    <input type="radio" name="answer" value="${idx}" ${answers[currentQ] === idx ? 'checked' : ''}>
                    <span>${String.fromCharCode(65 + idx)}. ${opt}</span>
                </label>
            `).join('');

            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.onchange = () => {
                    answers[currentQ] = parseInt(input.value);
                    localStorage.setItem('answers', JSON.stringify(answers));
                };
            });

            // Gambar
            const imgElem = document.getElementById('questionImg');
            if (q.image) {
                imgElem.src = q.image;
                imgElem.style.display = 'block';
            } else {
                imgElem.style.display = 'none';
            }

            // Audio control untuk listening
            if (currentQ < 20 && q.audio) {
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = q.audio;
                document.getElementById('audioControl').style.display = 'block';

                playCount = answers[currentQ] !== null ? 0 : 2; // Reset count kalau soal baru, atau kalau udah dijawab biar bisa review
                updatePlayCount();

                audioPlayer.onplay = () => {
                    if (playCount > 0) {
                        playCount--;
                        updatePlayCount();
                    }
                };

                document.getElementById('replayBtn').onclick = replayAudio;
            } else {
                document.getElementById('audioControl').style.display = 'none';
            }

            document.getElementById('prevBtn').disabled = currentQ === 0;
            document.getElementById('nextBtn').disabled = currentQ === 39;
        }

        function updatePlayCount() {
            const countElem = document.getElementById('replayCount');
            const player = document.getElementById('audioPlayer');
            const replayBtn = document.getElementById('replayBtn');
            countElem.textContent = `Sisa kesempatan dengar: ${playCount}`;
            if (playCount === 0) {
                player.disabled = true;
                replayBtn.disabled = true;
                player.controls = false; // Hide controls kalau habis
            } else {
                player.disabled = false;
                replayBtn.disabled = false;
                player.controls = true;
            }
        }

        function replayAudio() {
            if (playCount > 0) {
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            }
        }

        function goPrev() { if (currentQ > 0) window.location.href = `question.html?q=${currentQ - 1}`; }
        function goNext() { if (currentQ < 39) window.location.href = `question.html?q=${currentQ + 1}`; }
        function goBack() { window.location.href = 'exam.html'; }

        loadQuestion();
    </script>
</body>
</html>
