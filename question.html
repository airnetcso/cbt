<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soal Ujian</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { background: white; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; font-size: 20px; font-weight: bold; color: #2c3e50; }
        .content { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 20px; }
        @media (min-width: 768px) { .content { flex-direction: row; } }
        .options-column { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .question-column { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); flex: 1; }
        .question-text { font-size: 1.5em; line-height: 1.8; margin-bottom: 20px; }
        .question-img { max-width: 100%; height: auto; margin-top: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .audio-control { margin-top: 30px; padding: 20px; background: #f0f2f5; border-radius: 12px; text-align: center; }
        audio { width: 100%; max-width: 400px; margin-bottom: 15px; }
        .replay-btn { background: #3498db; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
        .replay-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        .replay-count { display: block; margin-top: 15px; font-weight: bold; font-size: 16px; color: #e74c3c; }

        /* Pilihan Ganda dengan Angka 1. 2. 3. 4. */
        .options label {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            margin: 12px 0;
            background: #ecf0f1;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .options label:hover {
            background: #d5dbdb;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .options input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3);
        }
        .options .number {
            font-weight: bold;
            font-size: 20px;
            min-width: 40px;
            color: #2c3e50;
        }
        .options .text {
            flex: 1;
        }
        .options input[type="radio"]:checked + .number {
            color: #27ae60;
        }

        .bottom-nav { background: white; padding: 15px; box-shadow: 0 -4px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
        .nav-btn { padding: 14px 20px; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; flex: 1; min-width: 100px; }
        .prev-btn { background: #3498db; color: white; }
        .back-btn { background: #e91e63; color: white; }
        .next-btn { background: #2ecc71; color: white; }
        .nav-btn:disabled { background: #bdc3c7; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="top-bar" id="questionTitle">Soal ...</div>
    <div class="content">
        <div class="options-column">
            <div class="options" id="options"></div>
        </div>
        <div class="question-column">
            <div class="question-text" id="questionText">Memuat soal...</div>
            <img id="questionImg" class="question-img" style="display:none;">
            <div class="audio-control" id="audioControl" style="display:none;">
                <audio id="audioPlayer" controls></audio>
                <button class="replay-btn" id="replayBtn">Replay dari Awal</button>
                <span class="replay-count" id="replayCount">Sisa kesempatan dengar: 2</span>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn prev-btn" id="prevBtn">◄ Sebelumnya</button>
        <button class="nav-btn back-btn">Kembali ke Navigasi</button>
        <button class="nav-btn next-btn" id="nextBtn">Berikutnya ►</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const currentQ = parseInt(urlParams.get('q')) || 0;
        let answers = JSON.parse(localStorage.getItem('answers')) || new Array(40).fill(null);
        let playCount = 2;

        const questions = [ /* Array 40 soal sama seperti versi final sebelumnya */ ];

        function loadQuestion() {
            const q = questions[currentQ];
            document.getElementById('questionTitle').textContent = `Soal ${currentQ + 1} - ${currentQ < 20 ? 'Listening' : 'Reading'}`;
            document.getElementById('questionText').innerHTML = q.question;

            // Pilihan ganda dengan angka 1. 2. 3. 4.
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = q.options.map((opt, idx) => `
                <label>
                    <input type="radio" name="answer" value="${idx}" ${answers[currentQ] === idx ? 'checked' : ''}>
                    <span class="number">${idx + 1}.</span>
                    <span class="text">${opt}</span>
                </label>
            `).join('');

            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.onchange = () => {
                    answers[currentQ] = parseInt(input.value);
                    localStorage.setItem('answers', JSON.stringify(answers));
                };
            });

            // Gambar
            const img = document.getElementById('questionImg');
            if (q.image) {
                img.src = q.image;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }

            // Audio listening
            if (currentQ < 20 && q.audio) {
                const audio = document.getElementById('audioPlayer');
                audio.src = q.audio;
                document.getElementById('audioControl').style.display = 'block';
                playCount = 2;
                updatePlayCount();

                audio.onplay = () => {
                    if (playCount > 0) playCount--;
                    updatePlayCount();
                };

                document.getElementById('replayBtn').onclick = () => {
                    if (playCount > 0) {
                        audio.currentTime = 0;
                        audio.play();
                    }
                };
            } else {
                document.getElementById('audioControl').style.display = 'none';
            }

            document.getElementById('prevBtn').disabled = currentQ === 0;
            document.getElementById('nextBtn').disabled = currentQ === 39;
        }

        function updatePlayCount() {
            document.getElementById('replayCount').textContent = `Sisa kesempatan dengar: ${playCount}`;
            const disabled = playCount === 0;
            document.getElementById('audioPlayer').disabled = disabled;
            document.getElementById('replayBtn').disabled = disabled;
            if (disabled) document.getElementById('audioPlayer').controls = false;
        }

        document.getElementById('prevBtn').onclick = () => { if (currentQ > 0) window.location.href = `question.html?q=${currentQ - 1}`; };
        document.getElementById('nextBtn').onclick = () => { if (currentQ < 39) window.location.href = `question.html?q=${currentQ + 1}`; };
        document.querySelector('.back-btn').onclick = () => window.location.href = 'exam.html';

        loadQuestion();
    </script>
</body>
</html>
